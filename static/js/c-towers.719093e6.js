var U=Object.defineProperty;var O=(p,a,t)=>a in p?U(p,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[a]=t;var r=(p,a,t)=>(O(p,typeof a!="symbol"?a+"":a,t),t);import{g as Y,C as $,t as R,D as S,c as N,w as l,l as o,G as z,o as C,k as e,j as G,q as F,F as y,n as h,A as f,z as A,H as X,I as j,J as q,L as J,M as W,N as Q,O as Z}from"./c-.pnpm.9643bc8d.js";import{a as tt,G as V}from"./c-GlobalData.ece1efc6.js";import{B as et,T as k,a as at,S as lt,b as P,c as _,C as st,d as it,e as ot,A as nt,f as ut,g as rt,h as dt,G as mt,i as ht,j as T}from"./c-unit.b99f82b2.js";import{B as K,G as x}from"./c-BaseUnit.337c31ff.js";class gt extends K{constructor(){super()}get buildingData(){return this.m_data}get range(){return this.buildingData.range}initBuilding(){}get skillInfo(){let a,t=0,s=null,i=null,b="";if(this.skills==null)return b;let c=[];for(a in this.skills)c.push(this.skills[a]);for(c.sort((d,n)=>d[x.DATA_KEY_INDEX]-n[x.DATA_KEY_INDEX]),t=0;t<c.length;t++)s=c[t],i=s.skillInfo,i!=""&&(b!=""&&(b+=`
`),b+=i);return b==""&&(b=this.buildingData.info),b}}class B extends K{constructor(t){super();r(this,"damage",0);r(this,"range",0);r(this,"attackType");this.m_data=et.getOnlyExample().getData(t),this.attackType=k.EFFECT_TYPE_ALL}get bulletData(){return this.m_data}}r(B,"MAX_LIFE_FRAME",50),r(B,"MAX_HEIGHT",5e3);class D extends gt{constructor(t){super();r(this,"m_level",0);r(this,"gem",null);r(this,"m_attackType","");this.tag="Tower",this.m_data=at.getOnlyExample().getData(t),this.initTower(),this.level=1}get towerData(){return this.m_data}initTower(){this.initSkills(),this.initStatuses(),this.initBuilding()}initSkills(){let t=null,s=null,i;if(this.skills={},this.towerData.skillPackageId!=""&&(t=new lt(this.towerData.skillPackageId,this.towerData.skillPackageLevel),t!=null&&t.skillsPackageData!=null))for(i of t.skillsPackageData.skillsList)s=new P(i,t.level,this).getSubClasses(),this.skills[s.data.kindId]=s;if(this.gem){if(t=this.gem.gemData.getSkillPackage(this.data.id),t!=null&&t.skillsPackageData!=null)for(i of t.skillsPackageData.skillsList)s=new P(i,t.level,this).getSubClasses(),this.skills[s.data.kindId]=s;this.skills[_.KIND_SCATTER_ATTACK]&&delete this.skills[_.KIND_DIVIDED_ATTACK]}this.updateAttackType()}get color(){return this.gem!=null?this.gem.gemData.color:6316128}get level(){return this.m_level}set level(t){this.m_level=t}get gemLevel(){return this.gem?this.gem.gemData.gemLevel:0}get ability(){var t=this.gemLevel;return this.towerData.isMagicTower?t==0?0:this.m_level*(.8+t/5)*2:this.m_level*(1+t/10)}get power(){let t=this.level,s=V.$_tower_worth_factor,i=this.gemLevel,b=this.valueCostConst(t);return Math.round((b+Math.pow(i,s[0])*s[1])*(s[2]+i/s[3]))}buildValue(t=-1){return t==-1&&(t=this.level),Math.floor(this.towerData.buildValueA+this.towerData.buildValueB*t+this.towerData.buildValueC*t*t)}buildCost(t=-1){return t==-1&&(t=this.level),Math.floor(this.towerData.buildCostA+this.towerData.buildCostB*t+this.towerData.buildCostC*t*t)}valueCost(t=-1){t==-1&&(t=this.level);let s=t*this.towerData.buildCostA+(t*t+t)/2*this.towerData.buildCostB+(t*t*t+t*t*3/2+t/2)/3*this.towerData.buildCostC+this.towerData.buildCost-this.towerData.buildCostA-this.towerData.buildCostB-this.towerData.buildCostC;return Math.round(s)}valueCostConst(t=-1){t==-1&&(t=this.level);let s=t*this.towerData.buildCostAConst+(t*t+t)/2*this.towerData.buildCostBConst+(t*t*t+t*t*3/2+t/2)/3*this.towerData.buildCostCConst+this.towerData.buildCostConst-this.towerData.buildCostAConst-this.towerData.buildCostBConst-this.towerData.buildCostCConst;return Math.round(s)}buffEffect(t=-1){return t==-1&&(t=this.level),this.towerData.buffEffect*t+1}damage(t=-1){let s=0;if(t==-1&&(t=this.level),this.skills[_.KIND_CHANGE_DAMAGE]instanceof st){let i=this.skills[_.KIND_CHANGE_DAMAGE];i.isChangeBase()?s=Math.round((i.damageA+i.damageB*t+i.damageC*t*t)*i.damageRate+i.damageAdd):s=Math.round((this.towerData.damageA+this.towerData.damageB*t+this.towerData.damageC*t*t)*i.damageRate+i.damageAdd)}else s=Math.round(this.towerData.damageA+this.towerData.damageB*t+this.towerData.damageC*t*t);return Math.max(s,0)}get range(){let t=0;if(this.skills[_.KIND_CHANGE_RANGE]instanceof it){let s=this.skills[_.KIND_CHANGE_RANGE];s.isChangeBase()?t=s.range*s.rangeRate+s.rangeAdd:t=this.towerData.range*s.rangeRate+s.rangeAdd}else t=this.towerData.range;return t}get rate(){let t=0;if(this.skills[_.KIND_CHANGE_RATE]instanceof ot){let s=this.skills[_.KIND_CHANGE_RATE];s.isChangeBase()?t=Math.round(s.rate*s.rateRate):t=Math.round(this.towerData.rate*s.rateRate)}else t=this.towerData.rate;return t}setGem(t){this.gem=t,this.initSkills()}updateAttackType(){let t=null;return this.m_attackType=k.EFFECT_TYPE_ALL,this.getBulletId()=="bullet100"?this.m_attackType=k.EFFECT_TYPE_LIGHTNING:this.skills[_.KIND_ATTACK_RATE]instanceof nt&&(t=this.skills[_.KIND_ATTACK_RATE],t.airRate<=0?this.m_attackType=k.EFFECT_TYPE_FLOOR:t.floorRate<=0&&(this.m_attackType=k.EFFECT_TYPE_AIR)),this.m_attackType}newBullet(){return new B(this.getBulletId())}getBulletId(){let t=null;return this.skills[_.KIND_CHANGE_BULLET]instanceof ut?(t=this.skills[_.KIND_CHANGE_BULLET],t.bulletId):this.towerData.bulletId}getInfoHtml(){return rt(this.skillInfo,this.color,!1,"14px")}}r(D,"TOWER","tower"),r(D,"GEM","gem"),r(D,"LEVEL_BUBBLE","levelBubble"),r(D,"RES_LEVEL_SECTION",5),r(D,"LEVEL_NAME",tt.getLanguageStr(2003)),r(D,"STATUS_READY","statusReady"),r(D,"FRAME_REST","rest"),r(D,"FRAME_READY","ready"),r(D,"FRAME_FIRE","fire");class ft extends dt{constructor(a){super(),this.m_data=mt.getOnlyExample().getData(a)}get gemData(){return this.m_data}}const _t=["innerHTML"],bt=h("p",null,"注：升级经验为塔下一级的 buildValue 值",-1),kt=Y({__name:"towers",setup(p){const a=$({isDefendMap:!1,towerId:"shaota",gemId:"",level:1,buildFrom:0,buildTo:1,buildPower:50}),t=R.map(V.$_towerAtt_Obj,(d,n)=>[d.name,n]),s=R.chain(V.$_global_properties.gem).toPairs().sortBy(d=>Number(Math.abs(d[1].index))).map(d=>[`${d[1].name} [${d[1].index}]`,d[0]]).value(),i=S(()=>{const d=new D(a.towerId);return d.level=a.level,a.gemId!==""&&d.setGem(new ft(a.gemId)),d}),b=()=>{T.currentMap=new T(a.isDefendMap?T.DEFEND_MAP_1:T.ENDLESS_MAP_1)},c=S(()=>{let d=0;if(a.buildFrom>a.buildTo)return NaN;for(let n=a.buildFrom+1;n<=a.buildTo;n++)d+=i.value.buildValue(n);return Math.round(d/a.buildPower)});return(d,n)=>{const H=X,u=j,I=q,L=J,g=W,E=Q,w=Z,v=z;return C(),N(v,{model:o(a),"label-width":"120px"},{default:l(()=>[e(u,{label:"是否为防线"},{default:l(()=>[e(H,{modelValue:o(a).isDefendMap,"onUpdate:modelValue":n[0]||(n[0]=m=>o(a).isDefendMap=m),onChange:b},null,8,["modelValue"])]),_:1}),e(E,null,{default:l(()=>[e(g,{span:12},{default:l(()=>[e(u,{label:"塔"},{default:l(()=>[e(L,{modelValue:o(a).towerId,"onUpdate:modelValue":n[1]||(n[1]=m=>o(a).towerId=m)},{default:l(()=>[(C(!0),G(y,null,F(o(t),([m,M])=>(C(),N(I,{label:m,value:M},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(g,{span:12},{default:l(()=>[e(u,{label:"宝石"},{default:l(()=>[e(L,{modelValue:o(a).gemId,"onUpdate:modelValue":n[2]||(n[2]=m=>o(a).gemId=m)},{default:l(()=>[e(I,{label:"无",value:""}),(C(!0),G(y,null,F(o(s),([m,M])=>(C(),N(I,{label:m,value:M},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,null,{default:l(()=>[e(g,{span:8},{default:l(()=>[e(u,{label:"等级"},{default:l(()=>[e(w,{modelValue:o(a).level,"onUpdate:modelValue":n[3]||(n[3]=m=>o(a).level=m),min:1},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"等级上限"},{default:l(()=>[h("label",null,f(o(i).towerData.levelMax),1)]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"升级经验"},{default:l(()=>[h("label",null,f(o(i).buildValue(o(i).level+1)),1)]),_:1})]),_:1})]),_:1}),e(E,null,{default:l(()=>[e(g,{span:8},{default:l(()=>[e(u,{label:"攻击力"},{default:l(()=>[h("label",null,f(o(i).damage()),1)]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"攻击频率"},{default:l(()=>[h("label",null,f(o(i).rate),1)]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"攻击范围"},{default:l(()=>[h("label",null,f(o(i).range),1)]),_:1})]),_:1})]),_:1}),e(u,{label:"简介"},{default:l(()=>[h("div",{innerHTML:o(i).getInfoHtml(),style:{"line-height":"1.5em"}},null,8,_t)]),_:1}),e(E,null,{default:l(()=>[e(g,{span:8},{default:l(()=>[e(u,{label:"ability"},{default:l(()=>[h("label",null,f(o(i).ability.toFixed(1)),1)]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"power"},{default:l(()=>[h("label",null,f(o(i).power),1)]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"buffEffect"},{default:l(()=>[h("label",null,f(o(i).buffEffect().toFixed(1)),1)]),_:1})]),_:1})]),_:1}),e(E,null,{default:l(()=>[e(g,{span:8},{default:l(()=>[e(u,{label:"buildValue"},{default:l(()=>[h("label",null,f(o(i).buildValue()),1)]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"buildCost"},{default:l(()=>[h("label",null,f(o(i).buildCost()),1)]),_:1})]),_:1}),e(g,{span:8},{default:l(()=>[e(u,{label:"valueCost"},{default:l(()=>[h("label",null,f(o(i).valueCost()),1)]),_:1})]),_:1})]),_:1}),h("div",null,[e(u,{label:"升级计算",style:{"margin-bottom":"0 !important"}},{default:l(()=>[A(" 从 "),e(w,{modelValue:o(a).buildFrom,"onUpdate:modelValue":n[4]||(n[4]=m=>o(a).buildFrom=m),size:"small","controls-position":"right",style:{width:"5em",margin:"0.5em"}},null,8,["modelValue"]),A(" 级到 "),e(w,{modelValue:o(a).buildTo,"onUpdate:modelValue":n[5]||(n[5]=m=>o(a).buildTo=m),size:"small","controls-position":"right",style:{width:"5em",margin:"0.5em"}},null,8,["modelValue"]),A(" 级， 苦工总力量 "),e(w,{modelValue:o(a).buildPower,"onUpdate:modelValue":n[6]||(n[6]=m=>o(a).buildPower=m),size:"small","controls-position":"right",style:{width:"8em",margin:"0.5em"}},null,8,["modelValue"])]),_:1}),e(u,{style:{"margin-bottom":"0 !important"}},{default:l(()=>[A(" 需要时间："),h("label",null,f(o(ht)(o(c))),1)]),_:1}),bt])]),_:1},8,["model"])}}});export{kt as default};
